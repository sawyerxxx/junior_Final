## 嵌入式提纲

### 什么是嵌入式?
嵌入式系统是以应用为中心,以计算机技术为基础，以计算机技术为基础,软硬件可剪裁,适应应用系统,对功能.可靠性.成本.体积.功耗严格要求的专用计算机系统

### ARM体系结构的命名规则

| 后缀变量 |含义|
|---|---|
|x:|系列号，如ARM7，ARM9等|
|z:|Cache|
|D:|拥有JTAG调试器，支持片上Debug|
|I:|嵌入式ICE 支持片上断点和调试点|
|J:|Jazelle加速|
|S:|可综合版本|
|y:|存储管理/保护单元|
|T:|支持16位压缩指令集 Thumb|
|M:|内嵌硬件乘法器(Multiplier)|
|E:|增强指令(基于TDMI)|
|F:|向量浮点单元|


### 5级流水结构
> ARM9E从ARM7TDMI的**3级**流水线增加到了**5级**,ARM9E的流水线中容纳了更多的逻辑操作。

* 取址:从存储器中取出指令并将其放入指令流水线
* 译码:对取出的指令进行译码
* 执行:对每一个操作数移位，产生ALU的效果
* 缓冲:如果需要则访问数据存储器,否则ALU的结果只是简单地缓冲一个时钟周期,以便所有的指令具有相同的流水线流程
* 回写:将指令产生的结果回写到寄存器堆,包括从存储器取出的数据

### 哈佛结构和冯诺依曼结构
冯诺依曼结构具有共有的数据存储空间以及分离的访问总线。哈佛结构在指令执行时,取址和取数可以**并行**，因此具有更高的执行效率
> ARM9是哈佛结构 而ARM7的是冯诺依曼结构

### 经典ARM处理器系列主要参数

|项目|ARM7|ARM9|ARM10|ARM11|
|---|---|---|---|---|
|流水线深度|3级|5级|6级|8级|
|典型频率/MHz|80|150|260|335|
|功耗|0.06|0.19+(cache)|0.5+(cache)|0.4+(cache)|
|MIPS/MHz|0.97|1.1|1.3|1.2|
|架构|冯诺依曼|哈佛|哈佛|哈佛|
|乘法器|8*32|8*32|16*32|16*32|

### S5PV210处理器简介
> S5PV210采用了ARM CortexTM-A8 内核，ARM V7指令集 ，主频可达1GHz，64/32位内部总线结构，32/32KB的数据/指令一级缓存,512KB的耳机缓存,可以实现2000DMPS(每秒运算2亿条指令)的高性能运算能力。

### AMBA 
2.0版的AMBA(Advanced Microcontroller Bus Architecture)标准定义了三组总线:

* AHB(Advanced High-performance Bus)
* ASB(Advanced System Bus)
* APB(Advanced Peripheral Bus 外设总线)

### S5PV210存储区地址映射
|寄存器|地址|接口|
|---|---|---|
|特殊功能寄存器|0xE000_0000-0xFFFF_FFFF|SFRS|
|BOOT|0x0000_0000-0x1FFF_FFFF|IROM&IRAM Reserved|

### 时钟域

* MSYS(主系统)域的HCLK_MSYS.PCLK_MSYS(包括CPU使用的是ARMCLK)
* DSYS(显示系统)域的HCLK_DSYS.PCLK_DSYS
* PSYS(外围系统)域的HCLK_PSYS.PCLK_PSYS

### 高性能操作的频率值
> 建议值

* freq(ARMCLK)=1000MHz
* freq(HCLK_MSYS)=200MHz
* freq(HCLK_PSYS)=133MHz

### 电源管理方案的六种模式

* NORMAL模式:在NORMAL模式，CPU核心运行，即软件正在运行

* IDLE模式:在IDLE模式中,CPU核的时钟被关闭了,其余的部分运行

* DEEP-IDLE模式:这个模式下,CPU的核心电源是关闭的,即CPU核心电源供应,但要关闭内部电源开关。剩下的部分芯片保持相同的正常模式，或关闭电源(除了音频电源域的低功耗MP3播放应用)

* STOP模式:在这个模式下,S5PV210的时钟是关闭的(除了RTC模块)。因此,应用程序编程停止并等待唤醒事件恢复其操作。同时,CPU核心时钟是禁用的
> NOTICE:在正常模式下电源关闭的模块在停止模式下仍保持电源关闭状态

* DEEP-STOP模式: 在这个模式下,CPU核心和剩余部分的芯片电源都是关闭的(除了TOP,RTC和ALIVE模块),这个TOP模块可以关闭电源或打开电源。

* SLEEP 模块:在这个模式下,S5PV210使用调节器或电源管理集成电路从外部关闭内部电源(VDD_ARM,VDD_INT,VDD,PLL).因此S5PV210的内部电源是“关闭”的
> NOTICE:RTC电源和外部电源RTC I/O引脚仍然是“开启”的，如果唤醒事件发生时,通过唤醒复位初始化S5PV210，就像我们常说的上电复位一样。

### ARM处理器模式

|处理器模式|处理器模式描述|
|---|----|
|用户模式(User,usr)|正常程序执行的模式|
|快速中断模式(FIQ,fiq)|用于高速数据传输和通道处理|
|普通中断模式(IRQ,irq)|用于通常的中断处理|
|管理模式(Supervisor,svc)|供OS使用的一种保护模式|
|数据访问中止模式(Abort,abt)|用于虚拟存储及存储保护|
|未定义指令中止模式(Undefined,und)|用于支持通过软件仿真硬件的协处理器|
|系统模式(System,sys)|用于运行特权级的操作系统任务|

### ARM寄存器
> ARM一般共有**37**个寄存器

* 31个通用寄存器:包括程序寄存器(PC)在内 这些寄存器都是**32位**寄存器
* 6个状态寄存器:这些寄存器也是**32位**寄存器

### R14寄存器

> R14寄存器又被称为连接寄存器(Link Register,LR) 

特殊作用:

* 每一种处理器模式自己的物理R14中u存放当前子程序的返回地址,当通过跳转指令调用子程序时,R14被设置为该子程序的返回地址;在子程序中,把R14的值赋值到程序计数器PC中时 子程序返回

* 当异常中断发生时 该异常模式特定的物理R14被设置成该异常模式将要返回的地址 对于有些异常模式 R14的值可能与将返回的地址存在一个常数的偏移量。

### R15寄存器

程序计数器R15又被记为PC 当正确读取了PC的值时,该值为当前指令地址加**8字节**，对于ARM指令集来说,PC指向当前指令的下两条指令的地址。

### 当前状态寄存器(CPSR)

* 格式

||31    30|29  28|27  |   |8  7|6  5|4  0||
|---|---|---|---|---|---|---|---|---|
|N|Z|C|Q|Unused|I|F|T|Modes|

* 各个标志位的解释(I F T为低八位控制位)

|标志位|场景|为 1|为 0|
|---|---|---|---|
|N(Negative)|两个补码表示的有符号运算|运算结果<0|结果>=0|
|Z(Zero)|运算结果==0|结果！=0|
|C(Carry)|加法指令 |产生进位|不产生进位|
|V(Overflow)|加/减法指令,操作数和运算结果为二进制的补码表示的带符号数|符号位溢出|其他情况|
|I|普通中断禁止位|禁止IRQ中断||
|F|快速中断禁止位|禁止FIQ中断||
|T(Version>=ARMv4 && 属于T系列)|异常中断 开启特权模式|执行Thumb指令|执行ARM指令|
|T(Verson>=ARMv5 && 不属于T系列)|异常中断 开启特权模式|强制下一条执行的指令产生为定义指中断|执行ARM指令|

* CPSR的七种模式

//TODO:ADD Here

### 基址变址寻址
>  变址寻址通常用于访问某基址地址附近的地址单元

* 描述:

基址变址寻址就是将寄存器(基址寄存器)的内容与指令中给出的地址偏移量相加 从而得到一个操作数的有效地址   

* 举个栗子:
```	
	LDR R0,[R1,#0x0F]	;将寄存器R1的值加上0X0F作为地址,取出此地址中的数保存在寄存器R0中
	LDR R0,[R1],#4		;以i寄存器R1的内容作为操作数的有效地址,从而取得操作数存入寄存器R0中
	LDR R0,[R1,R2]		;将寄存器R1的内容加上寄存器R2的内容形成操作数的有效地址,从而取得操作数存入寄存器R0中
```
### 多寄存器寻址

* 描述:

一次可以传输几个寄存器的值;可以用一条指令来传输最多16个通用寄存器的值

*举个栗子

```
	LDMIA 	R0,{R1,R2,R3,R4} 	;R1<-[R0],R2<-[R0+4];R3<-[R0+8];R4<-[R0+12]
	LDMIA	R0,{R3-R5,R10}	;R0<-R3;[R0+4]<-R4;[R0+8]<-R5,[R0+12]<-R10
```

> 后缀IA表示每次执行完加载/存储操作后,R0按字长度自增

### 堆栈寻址

> 数据结构:FILO

* 举个栗子:

```
		STMFD	SP!,{R1-R7,LR}		;将寄存器R1-R7,LR的值入栈,堆栈满递减
		LDMFD	SP!,{R1-R7,LR}		;将数据出栈,放入寄存器R1-R7,LR 满递减堆栈

```

> 满递减(FULL Decending Stack):堆栈通过减少存储器的地址向下增长,堆栈指针指向内含有数据项的最低地址

